<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixel Cat Expander</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Press Start 2P', cursive;
            background: #1a1a2e;
            color: #fff;
            overflow: hidden;
            height: 100vh;
            user-select: none;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }

        .game-container {
            display: flex;
            height: 100vh;
        }

        .sidebar {
            width: 360px;
            background: #0f3460;
            padding: 15px;
            overflow-y: auto;
            border-right: 4px solid #16213e;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5);
        }

        .sidebar::-webkit-scrollbar {
            width: 12px;
        }

        .sidebar::-webkit-scrollbar-track {
            background: #16213e;
            border: 2px solid #0f3460;
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: #e94560;
            border: 2px solid #0f3460;
        }

        .main-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            background: repeating-linear-gradient(
                0deg,
                #1a1a2e 0px,
                #1a1a2e 2px,
                #16213e 2px,
                #16213e 4px
            );
        }

        h1 {
            text-align: center;
            margin-bottom: 15px;
            font-size: 16px;
            text-shadow: 3px 3px 0 #e94560;
            color: #fff;
            letter-spacing: 2px;
        }

        .resources {
            background: #16213e;
            padding: 12px;
            border: 4px solid #0a0a1a;
            margin-bottom: 15px;
            box-shadow: 0 4px 0 #0a0a1a;
        }

        .resources h2 {
            font-size: 10px;
            margin-bottom: 10px;
            color: #e94560;
            text-shadow: 2px 2px 0 #000;
        }

        .resource-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 6px 0;
            padding: 8px;
            background: #0a0a1a;
            border: 3px solid;
            position: relative;
        }

        .resource-item::before {
            content: '';
            position: absolute;
            bottom: -3px;
            right: -3px;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: -1;
        }

        .resource-item.locked {
            opacity: 0.3;
            pointer-events: none;
        }

        .resource-name {
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 8px;
        }

        .resource-icon {
            width: 16px;
            height: 16px;
            image-rendering: pixelated;
            border: 2px solid #000;
        }

        .resource-amount {
            font-size: 10px;
            font-weight: bold;
            text-shadow: 2px 2px 0 #000;
        }

        .resource-rate {
            font-size: 7px;
            opacity: 0.8;
            margin-left: 6px;
        }

        .upgrades {
            margin-top: 10px;
        }

        .upgrade-section {
            margin-bottom: 15px;
            background: #16213e;
            padding: 10px;
            border: 4px solid #0a0a1a;
            box-shadow: 0 4px 0 #0a0a1a;
        }

        .upgrade-section.locked {
            opacity: 0.4;
        }

        .upgrade-section h3 {
            margin-bottom: 8px;
            font-size: 9px;
            color: #e94560;
            display: flex;
            align-items: center;
            gap: 6px;
            text-shadow: 2px 2px 0 #000;
        }

        .upgrade-btn {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            background: #e94560;
            border: 3px solid #c13551;
            color: white;
            font-family: 'Press Start 2P', cursive;
            font-weight: bold;
            cursor: pointer;
            font-size: 7px;
            position: relative;
            box-shadow: 0 4px 0 #8b2e3f;
            transition: all 0.1s;
        }

        .upgrade-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #8b2e3f;
        }

        .upgrade-btn:active:not(:disabled) {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #8b2e3f;
        }

        .upgrade-btn:disabled {
            background: #555;
            border-color: #333;
            cursor: not-allowed;
            opacity: 0.5;
            box-shadow: 0 4px 0 #222;
        }

        .upgrade-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }

        .upgrade-level {
            font-size: 6px;
            opacity: 0.9;
        }

        .upgrade-cost {
            font-size: 7px;
        }

        .pixel-canvas-container {
            position: relative;
            box-shadow: 0 8px 0 #000, 0 0 0 4px #16213e;
            border: 4px solid #0f3460;
            background: #000;
        }

        .pixel-canvas {
            display: grid;
            gap: 1px;
            background: #000;
            padding: 1px;
            cursor: crosshair;
        }

        .big-pixel {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 1px;
            background: #0a0a0a;
            border: 1px solid #1a1a1a;
        }

        .sub-pixel {
            width: 100%;
            height: 100%;
            background: #1a1a1a;
            transition: none;
            position: relative;
            image-rendering: pixelated;
        }

        .sub-pixel.filling {
            animation: pixelPulse 0.2s steps(2) infinite;
        }

        .sub-pixel.filled {
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        @keyframes pixelPulse {
            0%, 100% { 
                filter: brightness(1);
                transform: scale(1);
            }
            50% { 
                filter: brightness(1.5);
                transform: scale(1.1);
            }
        }

        .click-effect {
            position: absolute;
            pointer-events: none;
            font-weight: bold;
            font-size: 16px;
            text-shadow: 3px 3px 0 #000;
            animation: pixelFloatUp 0.8s steps(8) forwards;
            z-index: 1000;
            font-family: 'Press Start 2P', cursive;
        }

        @keyframes pixelFloatUp {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-80px) scale(1.5);
            }
        }

        .particle {
            position: absolute;
            pointer-events: none;
            width: 6px;
            height: 6px;
            image-rendering: pixelated;
            animation: pixelParticle 0.6s steps(6) forwards;
        }

        @keyframes pixelParticle {
            0% {
                opacity: 1;
                transform: translate(0, 0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(var(--tx), var(--ty)) scale(0);
            }
        }

        .stats {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #0f3460;
            padding: 15px 25px;
            border: 4px solid #16213e;
            text-align: center;
            box-shadow: 0 6px 0 #000;
        }

        .stats-title {
            font-size: 8px;
            opacity: 0.8;
            margin-bottom: 5px;
            color: #e94560;
        }

        .stats-value {
            font-size: 14px;
            font-weight: bold;
            text-shadow: 3px 3px 0 #000;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: #1a1a2e;
            border: 3px solid #000;
            margin-top: 8px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: repeating-linear-gradient(
                90deg,
                #e94560 0px,
                #e94560 4px,
                #c13551 4px,
                #c13551 8px
            );
            transition: width 0.1s steps(10);
        }

        .unlock-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: #e94560;
            padding: 30px 40px;
            border: 6px solid #c13551;
            font-size: 16px;
            font-weight: bold;
            z-index: 10000;
            animation: pixelPopIn 0.4s steps(4) forwards;
            box-shadow: 0 8px 0 #8b2e3f, 0 0 0 4px #000;
            text-align: center;
            text-shadow: 3px 3px 0 #000;
        }

        @keyframes pixelPopIn {
            0% { transform: translate(-50%, -50%) scale(0); }
            50% { transform: translate(-50%, -50%) scale(1.2); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        .material-info {
            font-size: 7px;
            opacity: 0.8;
            margin-top: 5px;
            line-height: 1.4;
        }

        .auto-mine-indicator {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #00ff00;
            border: 2px solid #000;
            animation: blink 0.5s steps(1) infinite;
            pointer-events: none;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Sidebar —Å –ø—Ä–æ–∫–∞—á–∫–∞–º–∏ -->
        <div class="sidebar">
            <h1>üê± PIXEL CAT<br>EXPANDER</h1>
            
            <div class="resources">
                <h2>‚ñº RESOURCES</h2>
                <div class="resource-item" id="dirt-resource" style="border-color: #8B4513;">
                    <div class="resource-name">
                        <div class="resource-icon" style="background: #8B4513;"></div>
                        <span>DIRT</span>
                    </div>
                    <div>
                        <span class="resource-amount" id="dirt-amount">0</span>
                        <span class="resource-rate" id="dirt-rate"></span>
                    </div>
                </div>
                <div class="resource-item locked" id="grass-resource" style="border-color: #228B22;">
                    <div class="resource-name">
                        <div class="resource-icon" style="background: #228B22;"></div>
                        <span>GRASS</span>
                    </div>
                    <div>
                        <span class="resource-amount" id="grass-amount">0</span>
                        <span class="resource-rate" id="grass-rate"></span>
                    </div>
                </div>
                <div class="resource-item locked" id="wood-resource" style="border-color: #D2691E;">
                    <div class="resource-name">
                        <div class="resource-icon" style="background: #D2691E;"></div>
                        <span>WOOD</span>
                    </div>
                    <div>
                        <span class="resource-amount" id="wood-amount">0</span>
                        <span class="resource-rate" id="wood-rate"></span>
                    </div>
                </div>
                <div class="resource-item locked" id="stone-resource" style="border-color: #808080;">
                    <div class="resource-name">
                        <div class="resource-icon" style="background: #808080;"></div>
                        <span>STONE</span>
                    </div>
                    <div>
                        <span class="resource-amount" id="stone-amount">0</span>
                        <span class="resource-rate" id="stone-rate"></span>
                    </div>
                </div>
                <div class="resource-item locked" id="metal-resource" style="border-color: #C0C0C0;">
                    <div class="resource-name">
                        <div class="resource-icon" style="background: #C0C0C0;"></div>
                        <span>METAL</span>
                    </div>
                    <div>
                        <span class="resource-amount" id="metal-amount">0</span>
                        <span class="resource-rate" id="metal-rate"></span>
                    </div>
                </div>
            </div>

            <div class="upgrades">
                <!-- –ó–µ–º–ª—è -->
                <div class="upgrade-section" id="dirt-upgrades">
                    <h3>
                        <div class="resource-icon" style="background: #8B4513;"></div>
                        DIRT UPGRADES
                    </h3>
                    <button class="upgrade-btn" id="dirt-click-upgrade">
                        <div class="upgrade-info">
                            <span>CLICK PWR</span>
                            <span class="upgrade-cost"><span id="dirt-click-cost">10</span></span>
                        </div>
                        <div class="upgrade-level">LVL:<span id="dirt-click-level">1</span> +<span id="dirt-click-power">1</span></div>
                    </button>
                    <button class="upgrade-btn" id="dirt-auto-upgrade">
                        <div class="upgrade-info">
                            <span>AUTO MINE</span>
                            <span class="upgrade-cost"><span id="dirt-auto-cost">50</span></span>
                        </div>
                        <div class="upgrade-level">LVL:<span id="dirt-auto-level">0</span> +<span id="dirt-auto-power">0</span>/s</div>
                    </button>
                </div>

                <!-- –¢—Ä–∞–≤–∞ -->
                <div class="upgrade-section locked" id="grass-upgrades">
                    <h3>
                        <div class="resource-icon" style="background: #228B22;"></div>
                        GRASS UPGRADES
                    </h3>
                    <div class="material-info">UNLOCK: 50 DIRT PIXELS</div>
                    <button class="upgrade-btn" id="grass-click-upgrade" disabled>
                        <div class="upgrade-info">
                            <span>CLICK PWR</span>
                            <span class="upgrade-cost"><span id="grass-click-cost">20</span></span>
                        </div>
                        <div class="upgrade-level">LVL:<span id="grass-click-level">1</span> +<span id="grass-click-power">1</span></div>
                    </button>
                    <button class="upgrade-btn" id="grass-auto-upgrade" disabled>
                        <div class="upgrade-info">
                            <span>AUTO MINE</span>
                            <span class="upgrade-cost"><span id="grass-auto-cost">100</span></span>
                        </div>
                        <div class="upgrade-level">LVL:<span id="grass-auto-level">0</span> +<span id="grass-auto-power">0</span>/s</div>
                    </button>
                </div>

                <!-- –î–µ—Ä–µ–≤–æ -->
                <div class="upgrade-section locked" id="wood-upgrades">
                    <h3>
                        <div class="resource-icon" style="background: #D2691E;"></div>
                        WOOD UPGRADES
                    </h3>
                    <div class="material-info">UNLOCK: 100 GRASS PIXELS</div>
                    <button class="upgrade-btn" id="wood-click-upgrade" disabled>
                        <div class="upgrade-info">
                            <span>CLICK PWR</span>
                            <span class="upgrade-cost"><span id="wood-click-cost">40</span></span>
                        </div>
                        <div class="upgrade-level">LVL:<span id="wood-click-level">1</span> +<span id="wood-click-power">1</span></div>
                    </button>
                    <button class="upgrade-btn" id="wood-auto-upgrade" disabled>
                        <div class="upgrade-info">
                            <span>AUTO MINE</span>
                            <span class="upgrade-cost"><span id="wood-auto-cost">200</span></span>
                        </div>
                        <div class="upgrade-level">LVL:<span id="wood-auto-level">0</span> +<span id="wood-auto-power">0</span>/s</div>
                    </button>
                </div>

                <!-- –ö–∞–º–µ–Ω—å -->
                <div class="upgrade-section locked" id="stone-upgrades">
                    <h3>
                        <div class="resource-icon" style="background: #808080;"></div>
                        STONE UPGRADES
                    </h3>
                    <div class="material-info">UNLOCK: 150 WOOD PIXELS</div>
                    <button class="upgrade-btn" id="stone-click-upgrade" disabled>
                        <div class="upgrade-info">
                            <span>CLICK PWR</span>
                            <span class="upgrade-cost"><span id="stone-click-cost">80</span></span>
                        </div>
                        <div class="upgrade-level">LVL:<span id="stone-click-level">1</span> +<span id="stone-click-power">1</span></div>
                    </button>
                    <button class="upgrade-btn" id="stone-auto-upgrade" disabled>
                        <div class="upgrade-info">
                            <span>AUTO MINE</span>
                            <span class="upgrade-cost"><span id="stone-auto-cost">400</span></span>
                        </div>
                        <div class="upgrade-level">LVL:<span id="stone-auto-level">0</span> +<span id="stone-auto-power">0</span>/s</div>
                    </button>
                </div>

                <!-- –ú–µ—Ç–∞–ª–ª -->
                <div class="upgrade-section locked" id="metal-upgrades">
                    <h3>
                        <div class="resource-icon" style="background: #C0C0C0;"></div>
                        METAL UPGRADES
                    </h3>
                    <div class="material-info">UNLOCK: 200 STONE PIXELS</div>
                    <button class="upgrade-btn" id="metal-click-upgrade" disabled>
                        <div class="upgrade-info">
                            <span>CLICK PWR</span>
                            <span class="upgrade-cost"><span id="metal-click-cost">150</span></span>
                        </div>
                        <div class="upgrade-level">LVL:<span id="metal-click-level">1</span> +<span id="metal-click-power">1</span></div>
                    </button>
                    <button class="upgrade-btn" id="metal-auto-upgrade" disabled>
                        <div class="upgrade-info">
                            <span>AUTO MINE</span>
                            <span class="upgrade-cost"><span id="metal-auto-cost">800</span></span>
                        </div>
                        <div class="upgrade-level">LVL:<span id="metal-auto-level">0</span> +<span id="metal-auto-power">0</span>/s</div>
                    </button>
                </div>
            </div>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–≥—Ä–æ–≤–∞—è –æ–±–ª–∞—Å—Ç—å -->
        <div class="main-area">
            <div class="stats">
                <div class="stats-title">CURRENT MATERIAL</div>
                <div class="stats-value" id="current-material">DIRT</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="material-progress" style="width: 0%"></div>
                </div>
                <div class="stats-title" style="margin-top: 8px; font-size: 8px;">
                    <span id="current-pixel-progress">0</span>/<span id="current-pixel-required">4</span> CLICKS
                </div>
            </div>

            <div class="pixel-canvas-container">
                <div class="pixel-canvas" id="pixel-canvas"></div>
            </div>
        </div>
    </div>

    <script>
        // –ü–∏–∫—Å–µ–ª—å–Ω—ã–π –∫–æ—Ç–∏–∫ 16x16
        const catPixelArt = [
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0],
            [0,0,1,1,1,0,0,0,0,0,0,1,1,1,0,0],
            [0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0],
            [0,0,1,1,2,1,1,1,1,1,1,2,1,1,0,0],
            [0,0,1,1,2,1,1,1,1,1,1,2,1,1,0,0],
            [0,0,1,1,1,1,1,3,3,1,1,1,1,1,0,0],
            [0,0,1,1,1,1,3,3,3,3,1,1,1,1,0,0],
            [0,0,1,1,1,1,1,3,3,1,1,1,1,1,0,0],
            [0,0,1,1,4,1,1,1,1,1,1,4,1,1,0,0],
            [0,0,0,1,1,4,1,1,1,1,4,1,1,0,0,0],
            [0,0,0,1,1,1,4,4,4,4,1,1,1,0,0,0],
            [0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0],
            [0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
        ];

        // ========== –ò–ì–†–û–í–û–ï –°–û–°–¢–û–Ø–ù–ò–ï ==========
        const gameState = {
            materials: {
                dirt: { amount: 0, clickPower: 1, autoPerSec: 0, clickLevel: 1, autoLevel: 0, unlocked: true, color: '#8B4513', emoji: 'üü§' },
                grass: { amount: 0, unlocked: false, color: '#228B22', emoji: 'üü¢' },
                wood: { amount: 0, unlocked: false, color: '#D2691E', emoji: 'üü´' },
                stone: { amount: 0, unlocked: false, color: '#808080', emoji: '‚ö´' },
                metal: { amount: 0, unlocked: false, color: '#C0C0C0', emoji: '‚ö™' }
            },
            currentLayer: 'dirt',
            currentPixelClicks: 0,
            autoPixelClicks: 0,
            layerProgress: { dirt: 0, grass: 0, wood: 0, stone: 0, metal: 0 },
            totalPixelsPerLayer: 0,
            clicksPerPixel: 4,
            upgradeCosts: {
                dirt: { click: 10, auto: 50 }
            },
            grid: [],
            pixelOrder: []
        };

        // ========== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ==========
        // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ - –∑–µ–º–ª—è –≤ –¥—Ä—É–≥–∏–µ —Ä–µ—Å—É—Ä—Å—ã
        const conversionRates = {
            grass: { dirtRequired: 1000, grassPerConversion: 200 },
            wood: { grassRequired: 200, woodPerConversion: 10 },
            stone: { woodRequired: 10, stonePerConversion: 5 },
            metal: { stoneRequired: 5, metalPerConversion: 1 }
        };

        // –ü–æ—Ä—è–¥–æ–∫ —Å–ª–æ—ë–≤
        const layerOrder = ['dirt', 'grass', 'wood', 'stone', 'metal'];

        // –¶–≤–µ—Ç–æ–≤–∞—è –ø–∞–ª–∏—Ç—Ä–∞ –¥–ª—è –∫–æ—Ç–∏–∫–∞
        const catColors = {
            0: '#1a1a1a',  // —Ñ–æ–Ω
            1: '#FF9E44',  // –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç –∫–æ—Ç–∏–∫–∞ (–æ—Ä–∞–Ω–∂–µ–≤—ã–π)
            2: '#000000',  // –≥–ª–∞–∑–∞
            3: '#FFB6C1',  // –Ω–æ—Å
            4: '#FFC080'   // —É—Å—ã/—Ä–æ—Ç
        };

        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –°–ï–¢–ö–ò ==========
        function initGrid() {
            const canvas = document.getElementById('pixel-canvas');
            canvas.style.gridTemplateColumns = `repeat(16, 32px)`;
            canvas.style.gridTemplateRows = `repeat(16, 32px)`;

            // –°–æ–∑–¥–∞–µ–º –ø–æ—Ä—è–¥–æ–∫ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø–∏–∫—Å–µ–ª–µ–π (–ø–æ —Å–ø–∏—Ä–∞–ª–∏ –æ—Ç —Ü–µ–Ω—Ç—Ä–∞)
            const centerX = 8, centerY = 8;
            const positions = [];
            
            for (let y = 0; y < 16; y++) {
                for (let x = 0; x < 16; x++) {
                    if (catPixelArt[y][x] !== 0) {
                        const dist = Math.sqrt(Math.pow(x - centerX, 2) + Math.pow(y - centerY, 2));
                        positions.push({ x, y, dist, index: y * 16 + x });
                    }
                }
            }
            
            positions.sort((a, b) => a.dist - b.dist);
            gameState.pixelOrder = positions.map(p => p.index);
            gameState.totalPixelsPerLayer = gameState.pixelOrder.length * 16; // –≤—Å–µ–≥–æ –ø–æ–¥–ø–∏–∫—Å–µ–ª–µ–π

            for (let y = 0; y < 16; y++) {
                for (let x = 0; x < 16; x++) {
                    const bigPixel = document.createElement('div');
                    bigPixel.className = 'big-pixel';
                    bigPixel.dataset.bigPixelIndex = y * 16 + x;
                    bigPixel.dataset.catValue = catPixelArt[y][x];

                    const subPixels = [];
                    for (let j = 0; j < 16; j++) {
                        const subPixel = document.createElement('div');
                        subPixel.className = 'sub-pixel';
                        subPixel.dataset.subPixelIndex = j;
                        bigPixel.appendChild(subPixel);
                        subPixels.push(subPixel);
                    }

                    gameState.grid.push({ 
                        element: bigPixel, 
                        subPixels: subPixels, 
                        layers: { dirt: 0, grass: 0, wood: 0, stone: 0, metal: 0 },
                        catValue: catPixelArt[y][x],
                        targetColor: catColors[catPixelArt[y][x]]
                    });
                    canvas.appendChild(bigPixel);
                }
            }
        }

        // ========== –û–ë–†–ê–ë–û–¢–ö–ê –ö–õ–ò–ö–û–í ==========
        function handleClick(event) {
            processClick(event, false);
        }

        function processClick(event, isAuto = false) {
            const dirtMat = gameState.materials.dirt;
            
            // –î–æ–±—ã–≤–∞–µ–º –∑–µ–º–ª—é
            const clickPower = dirtMat.clickPower;
            if (isAuto) {
                gameState.autoPixelClicks += clickPower;
            } else {
                gameState.currentPixelClicks += clickPower;
            }

            // –î–æ–±–∞–≤–ª—è–µ–º –∑–µ–º–ª—é
            dirtMat.amount += clickPower;

            // –≠—Ñ—Ñ–µ–∫—Ç—ã —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä—É—á–Ω—ã—Ö –∫–ª–∏–∫–æ–≤
            if (!isAuto && event) {
                createClickEffect(event, dirtMat);
                createParticles(event, dirtMat.color);
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –ø–æ–¥–ø–∏–∫—Å–µ–ª–∏
            const totalClicks = gameState.currentPixelClicks + gameState.autoPixelClicks;
            const pixelsToFill = Math.floor(totalClicks / gameState.clicksPerPixel);
            
            if (pixelsToFill > 0) {
                for (let i = 0; i < pixelsToFill; i++) {
                    fillSubPixel();
                }
                const remainder = totalClicks % gameState.clicksPerPixel;
                gameState.currentPixelClicks = remainder;
                gameState.autoPixelClicks = 0;
            }

            // –ê–≤—Ç–æ–∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
            autoConvertResources();

            updateProgress();
            updateUI();
        }

        // ========== –ó–ê–ü–û–õ–ù–ï–ù–ò–ï –ü–ò–ö–°–ï–õ–ï–ô –°–õ–û–Ø–ú–ò ==========
        function fillSubPixel() {
            const currentLayer = gameState.currentLayer;
            
            // –ù–∞—Ö–æ–¥–∏–º —Å–ª–µ–¥—É—é—â–∏–π –Ω–µ–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–π –ø–∏–∫—Å–µ–ª—å –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —Å–ª–æ—è
            let pixelIndex = -1;
            let subPixelIndex = -1;
            
            for (let i = 0; i < gameState.pixelOrder.length; i++) {
                const idx = gameState.pixelOrder[i];
                const bigPixel = gameState.grid[idx];
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–Ω–æ –ª–∏ –∫–ª–∞—Å—Ç—å —ç—Ç–æ—Ç —Å–ª–æ–π
                // –î–ª—è –∑–µ–º–ª–∏ - –≤—Å–µ–≥–¥–∞ –º–æ–∂–Ω–æ, –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö - —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Å–ª–æ–π –∑–∞–ø–æ–ª–Ω–µ–Ω
                if (currentLayer === 'dirt' || bigPixel.layers[getPreviousLayer(currentLayer)] >= 16) {
                    if (bigPixel.layers[currentLayer] < 16) {
                        pixelIndex = idx;
                        subPixelIndex = bigPixel.layers[currentLayer];
                        break;
                    }
                }
            }

            // –ï—Å–ª–∏ –≤–µ—Å—å —Å–ª–æ–π –∑–∞–ø–æ–ª–Ω–µ–Ω, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É
            if (pixelIndex === -1) {
                const nextLayer = getNextLayer(currentLayer);
                if (nextLayer) {
                    unlockLayer(nextLayer);
                    gameState.currentLayer = nextLayer;
                    // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å–ª–æ–∂–Ω–æ—Å—Ç—å
                    gameState.clicksPerPixel = Math.floor(gameState.clicksPerPixel * 1.5);
                    fillSubPixel(); // –ü—Ä–æ–±—É–µ–º –∑–∞–ø–æ–ª–Ω–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–π —Å–ª–æ–π
                    return;
                } else {
                    // –í—Å–µ —Å–ª–æ–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã - –∫–æ—Ç–∏–∫ –≥–æ—Ç–æ–≤!
                    showPrestigeNotification();
                    return;
                }
            }

            const bigPixel = gameState.grid[pixelIndex];
            const subPixel = bigPixel.subPixels[subPixelIndex];

            // –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
            subPixel.classList.add('filling');
            setTimeout(() => {
                subPixel.style.background = bigPixel.targetColor;
                subPixel.classList.remove('filling');
                subPixel.classList.add('filled');
            }, 200);

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏
            bigPixel.layers[currentLayer]++;
            gameState.layerProgress[currentLayer]++;
        }

        // –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Å–ª–æ–π
        function getPreviousLayer(layer) {
            const index = layerOrder.indexOf(layer);
            return index > 0 ? layerOrder[index - 1] : null;
        }

        // –ü–æ–ª—É—á–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–π —Å–ª–æ–π
        function getNextLayer(layer) {
            const index = layerOrder.indexOf(layer);
            return index < layerOrder.length - 1 ? layerOrder[index + 1] : null;
        }

        // –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å–ª–æ—è
        function unlockLayer(layerName) {
            if (gameState.materials[layerName].unlocked) return;
            
            gameState.materials[layerName].unlocked = true;

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            const notification = document.createElement('div');
            notification.className = 'unlock-notification';
            notification.innerHTML = `
                üé® NEW LAYER üé®<br>
                UNLOCKED!<br><br>
                <span style="font-size: 20px;">
                    ${layerName.toUpperCase()}
                </span>
            `;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'pixelPopIn 0.4s steps(4) reverse';
                setTimeout(() => notification.remove(), 400);
            }, 2000);

            // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º UI
            document.getElementById(`${layerName}-resource`).classList.remove('locked');

            updateUI();
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
        function showPrestigeNotification() {
            const notification = document.createElement('div');
            notification.className = 'unlock-notification';
            notification.innerHTML = `
                üéâ CAT COMPLETE! üéâ<br><br>
                <span style="font-size: 14px;">
                    –ü–∏–∫—Å–µ–ª—å–Ω—ã–π –∫–æ—Ç–∏–∫ –≥–æ—Ç–æ–≤!<br>
                    –í—Å–µ 5 —Å–ª–æ—ë–≤ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã!
                </span>
            `;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'pixelPopIn 0.4s steps(4) reverse';
                setTimeout(() => notification.remove(), 400);
            }, 4000);
        }

        // ========== –í–ò–ó–£–ê–õ–¨–ù–´–ï –≠–§–§–ï–ö–¢–´ ==========
        // –°–æ–∑–¥–∞–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∞ –∫–ª–∏–∫–∞
        function autoConvertResources() {
            // –ó–µ–º–ª—è -> –¢—Ä–∞–≤–∞ (1000 –∑–µ–º–ª–∏ = 200 —Ç—Ä–∞–≤—ã)
            if (gameState.materials.grass.unlocked) {
                const dirtAmount = gameState.materials.dirt.amount;
                const grassConv = conversionRates.grass;
                if (dirtAmount >= grassConv.dirtRequired) {
                    const conversions = Math.floor(dirtAmount / grassConv.dirtRequired);
                    gameState.materials.dirt.amount -= conversions * grassConv.dirtRequired;
                    gameState.materials.grass.amount += conversions * grassConv.grassPerConversion;
                }
            }

            // –¢—Ä–∞–≤–∞ -> –î–µ—Ä–µ–≤–æ (200 —Ç—Ä–∞–≤—ã = 10 –¥–µ—Ä–µ–≤–∞)
            if (gameState.materials.wood.unlocked) {
                const grassAmount = gameState.materials.grass.amount;
                const woodConv = conversionRates.wood;
                if (grassAmount >= woodConv.grassRequired) {
                    const conversions = Math.floor(grassAmount / woodConv.grassRequired);
                    gameState.materials.grass.amount -= conversions * woodConv.grassRequired;
                    gameState.materials.wood.amount += conversions * woodConv.woodPerConversion;
                }
            }

            // –î–µ—Ä–µ–≤–æ -> –ö–∞–º–µ–Ω—å (10 –¥–µ—Ä–µ–≤–∞ = 5 –∫–∞–º–Ω—è)
            if (gameState.materials.stone.unlocked) {
                const woodAmount = gameState.materials.wood.amount;
                const stoneConv = conversionRates.stone;
                if (woodAmount >= stoneConv.woodRequired) {
                    const conversions = Math.floor(woodAmount / stoneConv.woodRequired);
                    gameState.materials.wood.amount -= conversions * stoneConv.woodRequired;
                    gameState.materials.stone.amount += conversions * stoneConv.stonePerConversion;
                }
            }

            // –ö–∞–º–µ–Ω—å -> –ú–µ—Ç–∞–ª–ª (5 –∫–∞–º–Ω—è = 1 –º–µ—Ç–∞–ª–ª)
            if (gameState.materials.metal.unlocked) {
                const stoneAmount = gameState.materials.stone.amount;
                const metalConv = conversionRates.metal;
                if (stoneAmount >= metalConv.stoneRequired) {
                    const conversions = Math.floor(stoneAmount / metalConv.stoneRequired);
                    gameState.materials.stone.amount -= conversions * metalConv.stoneRequired;
                    gameState.materials.metal.amount += conversions * metalConv.metalPerConversion;
                }
            }
        }
        function createClickEffect(event, material) {
            const effect = document.createElement('div');
            effect.className = 'click-effect';
            effect.textContent = `+${material.clickPower}`;
            effect.style.color = material.color;
            effect.style.left = event.clientX + 'px';
            effect.style.top = event.clientY + 'px';
            document.body.appendChild(effect);

            setTimeout(() => effect.remove(), 800);
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —á–∞—Å—Ç–∏—Ü
        function createParticles(event, color) {
            for (let i = 0; i < 6; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.background = color;
                particle.style.left = event.clientX + 'px';
                particle.style.top = event.clientY + 'px';
                
                const angle = (Math.PI * 2 * i) / 6;
                const distance = 40 + Math.random() * 40;
                particle.style.setProperty('--tx', Math.cos(angle) * distance + 'px');
                particle.style.setProperty('--ty', Math.sin(angle) * distance + 'px');
                
                document.body.appendChild(particle);
                setTimeout(() => particle.remove(), 600);
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
        function updateProgress() {
            const currentMat = gameState.materials[gameState.currentMaterial];
            const totalClicks = gameState.currentPixelClicks + gameState.autoPixelClicks;
            const progress = (totalClicks / currentMat.clicksRequired) * 100;
            document.getElementById('material-progress').style.width = progress + '%';
            document.getElementById('current-pixel-progress').textContent = totalClicks;
            document.getElementById('current-pixel-required').textContent = currentMat.clicksRequired;
        }

        // –£–ª—É—á—à–µ–Ω–∏—è
        function setupUpgrades() {
            const materials = ['dirt', 'grass', 'wood', 'stone', 'metal'];

            materials.forEach(mat => {
                // –£–ª—É—á—à–µ–Ω–∏–µ –∫–ª–∏–∫–∞
                document.getElementById(`${mat}-click-upgrade`).addEventListener('click', () => {
                    const cost = gameState.upgradeCosts[mat].click;
                    if (gameState.materials[mat].amount >= cost) {
                        gameState.materials[mat].amount -= cost;
                        gameState.materials[mat].clickLevel++;
                        gameState.materials[mat].clickPower = gameState.materials[mat].clickLevel;
                        gameState.upgradeCosts[mat].click = Math.floor(cost * 1.5);
                        updateUI();
                    }
                });

                // –£–ª—É—á—à–µ–Ω–∏–µ –∞–≤—Ç–æ-–¥–æ–±—ã—á–∏
                document.getElementById(`${mat}-auto-upgrade`).addEventListener('click', () => {
                    const cost = gameState.upgradeCosts[mat].auto;
                    if (gameState.materials[mat].amount >= cost) {
                        gameState.materials[mat].amount -= cost;
                        gameState.materials[mat].autoLevel++;
                        gameState.materials[mat].autoPerSec = gameState.materials[mat].autoLevel * 0.5;
                        gameState.upgradeCosts[mat].auto = Math.floor(cost * 1.8);
                        updateUI();
                    }
                });
            });
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–æ–±—ã—á–∞
        function autoMine() {
            for (const [matName, mat] of Object.entries(gameState.materials)) {
                if (mat.unlocked && mat.autoPerSec > 0) {
                    // –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ—Å—É—Ä—Å—ã
                    mat.amount += mat.autoPerSec / 10;
                    
                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ–º "–∫–ª–∏–∫–∏" –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ø–∏–∫—Å–µ–ª–µ–π
                    if (matName === gameState.currentMaterial) {
                        const autoClicksToAdd = mat.autoPerSec / 10;
                        gameState.autoPixelClicks += autoClicksToAdd;
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –ø–æ–¥–ø–∏–∫—Å–µ–ª–∏
                        const totalClicks = gameState.currentPixelClicks + gameState.autoPixelClicks;
                        const pixelsToFill = Math.floor(totalClicks / mat.clicksRequired);
                        
                        if (pixelsToFill > 0) {
                            for (let i = 0; i < pixelsToFill; i++) {
                                fillSubPixel();
                            }
                            // –û—Å—Ç–∞—Ç–æ–∫ –∫–ª–∏–∫–æ–≤ –æ—Å—Ç–∞—ë—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –ø–æ–¥–ø–∏–∫—Å–µ–ª—å
                            const remainder = totalClicks % mat.clicksRequired;
                            gameState.currentPixelClicks = remainder;
                            gameState.autoPixelClicks = 0;
                        }
                    }
                }
            }
            
            // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
            autoConvert();
            updateProgress();
            updateUI();
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è
        function autoConvert() {
            for (const [matName, conversion] of Object.entries(conversionRates)) {
                if (gameState.materials[matName].unlocked) {
                    const fromMat = gameState.materials[conversion.from];
                    if (fromMat.amount >= conversion.rate) {
                        const convertAmount = Math.floor(fromMat.amount / conversion.rate);
                        fromMat.amount -= convertAmount * conversion.rate;
                        gameState.materials[matName].amount += convertAmount;
                    }
                }
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
        function updateUI() {
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
            for (const [matName, mat] of Object.entries(gameState.materials)) {
                document.getElementById(`${matName}-amount`).textContent = Math.floor(mat.amount);
                if (mat.autoPerSec > 0) {
                    document.getElementById(`${matName}-rate`).textContent = `+${mat.autoPerSec.toFixed(1)}/s`;
                }

                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ —É–ª—É—á—à–µ–Ω–∏–π
                const clickBtn = document.getElementById(`${matName}-click-upgrade`);
                const autoBtn = document.getElementById(`${matName}-auto-upgrade`);
                
                if (mat.unlocked) {
                    const clickCost = gameState.upgradeCosts[matName].click;
                    const autoCost = gameState.upgradeCosts[matName].auto;

                    clickBtn.disabled = mat.amount < clickCost;
                    autoBtn.disabled = mat.amount < autoCost;

                    document.getElementById(`${matName}-click-cost`).textContent = clickCost;
                    document.getElementById(`${matName}-auto-cost`).textContent = autoCost;
                    document.getElementById(`${matName}-click-level`).textContent = mat.clickLevel;
                    document.getElementById(`${matName}-auto-level`).textContent = mat.autoLevel;
                    document.getElementById(`${matName}-click-power`).textContent = mat.clickPower;
                    document.getElementById(`${matName}-auto-power`).textContent = mat.autoPerSec.toFixed(1);
                }
            }

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞
            const currentMat = gameState.materials[gameState.currentMaterial];
            document.getElementById('current-material').textContent = gameState.currentMaterial.toUpperCase();
            document.getElementById('current-material').style.color = currentMat.color;
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function init() {
            initGrid();
            setupUpgrades();
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–æ–≤ –ø–æ –∫–∞–Ω–≤–∞—Å—É
            document.getElementById('pixel-canvas').addEventListener('click', handleClick);

            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–æ–±—ã—á–∞ –∫–∞–∂–¥—ã–µ 100–º—Å
            setInterval(autoMine, 100);

            // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
            setInterval(saveGame, 30000);

            // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
            loadGame();

            updateUI();
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–≥—Ä—ã
        function saveGame() {
            const saveData = {
                materials: gameState.materials,
                currentMaterial: gameState.currentMaterial,
                currentPixelClicks: gameState.currentPixelClicks,
                autoPixelClicks: gameState.autoPixelClicks,
                totalFilledSubPixels: gameState.totalFilledSubPixels,
                upgradeCosts: gameState.upgradeCosts,
                gridState: gameState.grid.map(g => ({ filledCount: g.filledCount, material: g.material }))
            };
            localStorage.setItem('pixelCatExpanderSave', JSON.stringify(saveData));
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã
        function loadGame() {
            const save = localStorage.getItem('pixelCatExpanderSave');
            if (save) {
                const loaded = JSON.parse(save);
                
                Object.assign(gameState.materials, loaded.materials);
                gameState.currentMaterial = loaded.currentMaterial;
                gameState.currentPixelClicks = loaded.currentPixelClicks || 0;
                gameState.autoPixelClicks = loaded.autoPixelClicks || 0;
                gameState.totalFilledSubPixels = loaded.totalFilledSubPixels;
                gameState.upgradeCosts = loaded.upgradeCosts;

                // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –ø–∏–∫—Å–µ–ª–µ–π
                if (loaded.gridState) {
                    for (let i = 0; i < gameState.grid.length; i++) {
                        if (loaded.gridState[i] && loaded.gridState[i].filledCount > 0) {
                            const bigPixel = gameState.grid[i];
                            for (let j = 0; j < loaded.gridState[i].filledCount; j++) {
                                const subPixel = bigPixel.subPixels[j];
                                subPixel.style.background = bigPixel.targetColor;
                                subPixel.classList.add('filled');
                            }
                            bigPixel.filledCount = loaded.gridState[i].filledCount;
                        }
                    }
                }

                // –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ UI –¥–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
                for (const [matName, mat] of Object.entries(gameState.materials)) {
                    if (mat.unlocked && matName !== 'dirt') {
                        document.getElementById(`${matName}-resource`).classList.remove('locked');
                        document.getElementById(`${matName}-upgrades`).classList.remove('locked');
                        document.getElementById(`${matName}-click-upgrade`).disabled = false;
                        document.getElementById(`${matName}-auto-upgrade`).disabled = false;
                    }
                }

                updateProgress();
                updateUI();
            }
        }

        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        init();
    </script>
</body>
</html>